<!DOCTYPE html>
<html lang="en">
<head>

<base href=".">

<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">


<title>Compiler properties</title>

<link rel="stylesheet" href="assets/css/custom_bootstrap.css" type="text/css">
<link rel="stylesheet" href="assets/css/bootstrap-toc.min.css" type="text/css">
<link rel="stylesheet" href="assets/css/frontend.css" type="text/css">
<link rel="stylesheet" href="assets/css/jquery.mCustomScrollbar.min.css">


<script src="assets/js/mustache.min.js"></script>
<script src="assets/js/jquery.js"></script>
<script src="assets/js/scrollspy.js"></script>
<script src="assets/js/bootstrap.js"></script>
<script src="assets/js/typeahead.jquery.min.js"></script>
<script src="assets/js/search.js"></script>
<script src="assets/js/isotope.pkgd.min.js"></script>
<script src="assets/js/compare-versions.js"></script>
<script src="assets/js/jquery.mCustomScrollbar.concat.min.js"></script>
<script src="assets/js/bootstrap-toc.min.js"></script>
<script src="assets/js/jquery.touchSwipe.min.js"></script>
<script src="assets/js/anchor.min.js"></script>
<script src="assets/js/tag_filtering.js"></script>
<script src="assets/js/language_switching.js"></script>

<script src="assets/js/lines_around_headings.js"></script>


<link rel="icon" type="image/png" href="assets/images/favicon.png">
<link rel="shortcut icon" href="assets/images/favicon.png">

</head>

<body class="no-script
" data-spy="scroll" data-target="#toc" data-offset="70">

<script>
$('body').removeClass('no-script');
</script>

<nav class="navbar navbar-fixed-top navbar-default" id="topnav">
	<div class="container-fluid">
		<div class="navbar-right">
			<a id="toc-toggle">
				<span class="glyphicon glyphicon-menu-right"></span>
				<span class="glyphicon glyphicon-menu-left"></span>
			</a>
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-wrapper" aria-expanded="false">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<form class="navbar-form pull-right" id="navbar-search-form">
                               <div class="form-group has-feedback">
                                       <input type="text" class="form-control input-sm" name="search" id="sidenav-lookup-field" placeholder="search" disabled>
				       <span class="glyphicon glyphicon-search form-control-feedback" id="search-mgn-glass"></span>
                               </div>
                        </form>
		</div>
		<div class="navbar-header">
			<a id="sidenav-toggle">
				<span class="glyphicon glyphicon-menu-right"></span>
				<span class="glyphicon glyphicon-menu-left"></span>
			</a>
			<a id="home-link" href="index.html" class="hotdoc-navbar-brand">
				<img src="assets/images/meson_logo.png" alt="Home">
			</a>
		</div>
		<div class="navbar-collapse collapse" id="navbar-wrapper">
			<ul class="nav navbar-nav" id="menu">
				
<li class="dropdown">
	<a class="dropdown-toggle" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
		モジュール <span class="caret"></span>
	</a>
	<ul class="dropdown-menu" id="modules-menu">
					<li>
				<a href="Gnome-module.html">GNOME</a>
			</li>
					<li>
				<a href="i18n-module.html">i18n</a>
			</li>
					<li>
				<a href="Pkgconfig-module.html">Pkgconfig</a>
			</li>
					<li>
				<a href="Python-3-module.html">Python 3</a>
			</li>
					<li>
				<a href="Qt4-module.html">Qt4</a>
			</li>
					<li>
				<a href="Qt5-module.html">Qt5</a>
			</li>
					<li>
				<a href="RPM-module.html">RPM</a>
			</li>
					<li>
				<a href="Windows-module.html">Windows</a>
			</li>
			</ul>
</li>
<li class="dropdown">
	<a class="dropdown-toggle" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
		クィックリファレンス <span class="caret"></span>
	</a>
	<ul class="dropdown-menu" id="quick-refs-menu">
					<li>
				<a href="Reference-manual.html">関数</a>
			</li>
					<li>
				<a href="Build-options.html">オプション</a>
			</li>
					<li>
				<a href="Configuration.html">設定</a>
			</li>
					<li>
				<a href="Dependencies.html">依存関係</a>
			</li>
					<li>
				<a href="Unit-tests.html">テスト</a>
			</li>
					<li>
				<a href="Syntax.html">文法</a>
			</li>
			</ul>
</li>
			</ul>
			<div class="hidden-xs hidden-sm navbar-text navbar-center">
				<p><b>Meson ビルドシステム</b></p>
			</div>
		</div>
	</div>
</nav>

<main>
<div data-extension="core" data-hotdoc-in-toplevel="True" data-hotdoc-project="Meson-documentation-1.0" data-hotdoc-ref="Compiler-properties.html" class="page_container" id="page-wrapper">
<script src="assets/js/utils.js"></script>

<div class="panel panel-collapse oc-collapsed" id="sidenav" data-hotdoc-role="navigation">
	<script src="assets/js/navigation.js"></script>
	<script src="assets/js/sitemap.js"></script>
</div>

<div id="body">
	<div id="main">
				    <div id="page-description" data-hotdoc-source="Compiler-properties.md" data-hotdoc-role="main">
        <h1 id="compiler-properties">Compiler properties</h1>
<p>Not all compilers and platforms are alike. Therefore Meson provides the
tools to detect properties of the system during configure time. To get most
of this information, you first need to extract the <em>compiler object</em> from
the main <em>meson</em> variable.</p>
<p><code>meson compiler = meson.get_compiler('c')</code></p>
<p>Here we extract the C compiler. We could also have given the argument <code>cpp</code>
to get the C++ compiler, <code>objc</code> to get the objective C compiler and so
on. The call is valid for all languages specified in the <em>project</em>
declaration. Trying to obtain some other compiler will lead to an
unrecoverable error.</p>
<h2 id="system-information">System information</h2>
<p>This is a bit complex and more thoroughly explained on the page on <a href="Cross-compilation.html">cross
compilation</a>. But if you just want to know the
operating system your code will run on, issue this command:</p>
<p><code>meson host_machine.system()</code></p>
<h1 id="compiler-id">Compiler id</h1>
<p>The compiler object has a method called <code>get_id</code>, which returns a lower case
string describing the "family" of the compiler. See <a href="Reference-tables.html">reference
tables</a> for a list of supported compiler ids.</p>
<h1 id="does-code-compile">Does code compile?</h1>
<p>Sometimes the only way to test the system is to try to compile some sample
code and see if it works. This is a two-phase operation. First we define
some code using the multiline string operator:</p>
<pre><code class="language-meson">} ''' ```

Then we can run the test.

```meson result = compiler.compiles(code, name : 'basic check')  ```

The variable *result* will now contain either `true` or `false` depending on
whether the compilation succeeded or not. The keyword argument `name` is
optional. If it is specified, Meson will write the result of the check to
its log.

Does code compile and link?
==

Sometimes it is necessary to check whether a certain code fragment not only
compiles, but also links successfully, e.g. to check if a symbol is actually
present in a library. This can be done using the '''.links()''' method on a
compiler object like this:

```meson code = '''#include&lt;stdio.h&gt; void func() { printf("Compile me.\n");
} ''' ```

Then we can run the test.

```meson result = compiler.links(code, args : '-lfoo', name : 'link check')
</code></pre>
<p>The variable <em>result</em> will now contain either <code>true</code> or <code>false</code> depending on
whether the compilation and linking succeeded or not. The keyword argument
<code>name</code> is optional. If it is specified, Meson will write the result of the
check to its log.</p>
<h1 id="compile-and-run-test-application">Compile and run test application</h1>
<p>Here is how you would compile and run a small test application.</p>
<pre><code class="language-meson">code = '''#include&lt;stdio.h&gt;
int main(int argc, char **argv) {
  printf("%s\n", "stdout");
  fprintf(stderr, "%s\n", "stderr");
  return 0;
}
'''
result = compiler.run(code, name : 'basic check')
</code></pre>
<p>The <code>result</code> variable encapsulates the state of the test, which can be
extracted with the following methods. The <code>name</code> keyword argument works the
same as with <code>compiles</code>.</p>
<table>
<thead>
<tr>
<th> Method</th>
<th> Return value</th>
</tr>
</thead>
<tbody>
<tr>
<td> compiled</td>
<td> <code>True</code> if compilation succeeded. If <code>false</code> then all other methods return undefined values.</td>
</tr>
<tr>
<td> returncode</td>
<td> The return code of the application as an integer</td>
</tr>
<tr>
<td> stdout</td>
<td> Program's standard out as text.</td>
</tr>
<tr>
<td> stderr</td>
<td> Program's standard error as text.</td>
</tr>
</tbody>
</table>
<p>Here is an example usage:</p>
<pre><code class="language-meson">if result.stdout().strip() == 'some_value'
  # do something
endif
</code></pre>
<h1 id="does-a-header-exist">Does a header exist?</h1>
<p>Header files provided by different platforms vary quite a lot. Meson has
functionality to detect whether a given header file is available on the
system. The test is done by trying to compile a simple test program that
includes the specified header. The following snippet describes how this
feature can be used.</p>
<pre><code class="language-meson">if compiler.has_header('sys/fstat.h')
  # header exists, do something
endif
</code></pre>
<h1 id="expression-size">Expression size</h1>
<p>Often you need to determine the size of a particular element (such as <code>int</code>,
<code>wchar_t</code> or <code>char*</code>). Using the <code>compiler</code> variable mentioned above, the
check can be done like this.</p>
<pre><code class="language-meson">'#include&lt;wchar.h&gt;')  ```

This will put the size of `wchar_t` as reported by sizeof into variable
`wcharsize`. The keyword argument `prefix` is optional. If specified its
contents is put at the top of the source file. This argument is typically
used for setting `#include` directives in configuration files.

In older versions (&lt;= 0.30) meson would error out if the size could not be
determined. Since version 0.31 it returns -1 if the size could not be
determined.

Does a function exist?
==

Just having a header doesn't say anything about its contents. Sometimes you
need to explicitly check if some function exists. This is how we would check
whether the function `open_memstream` exists in header `stdio.h`

```meson
if compiler.has_function('open_memstream', prefix : '#include &lt;stdio.h&gt;')
  # function exists, do whatever is required.
endif
</code></pre>
<p>Note that, on macOS programs can be compiled targeting older macOS versions
than the one that the program is compiled on. It can't be assumed that the
OS version that is compiled on matches the OS version that the binary will
run on.</p>
<p>Therefore when detecting function availability with <code>has_function</code>, it is
important to specify the correct header in the prefix argument.</p>
<p>In the example above, the function <code>open_memstream</code> is detected, which was
introduced in macOS 10.13. When the user builds on macOS 10.13, but
targeting macOS 10.11 (<code>-mmacosx-version-min=10.11</code>), this will correctly
report the function as missing. Without the header however, it would lack
the necessary availability information and incorrectly report the function
as available.</p>
<h1 id="does-a-structure-contain-a-member">Does a structure contain a member?</h1>
<p>Some platforms have different standard structures. Here's how one would
check if a struct called <code>mystruct</code> from header <code>myheader.h</code> contains a
member called <code>some_member</code>.</p>
<pre><code class="language-meson">if compiler.has_member('struct mystruct', 'some_member', prefix : '#include&lt;myheader.h&gt;')
  # member exists, do whatever is required
endif
</code></pre>
<h1 id="type-alignment">Type alignment</h1>
<p>Most platforms can't access some data types at any address. For example it
is common that a <code>char</code> can be at any address but a 32 bit integer only at
locations which are divisible by four. Determining the alignment of data
types is simple.</p>
<pre><code class="language-meson">contain the value 4.  ```

## Has argument

This method tests if the compiler supports a given command line
argument. This is implemented by compiling a small file with the given
argument.

```meson has_special_flags = compiler.has_argument('-Wspecialthing')  ```

*Note*: some compilers silently swallow command line arguments they do
not understand. Thus this test can not be made 100% reliable.
</code></pre>

    </div>
        




		
	</div>
	<div id="search_results">
		<p>The results of the search are</p>
	</div>
	<hr>
	<div id="footer">
		    

	</div>
</div>

<div id="toc-column">
	
		<div class="edit-button">
		

	</div>
		<div id="toc-wrapper">
		<nav id="toc"></nav>
	</div>
</div>
</div>
</main>


<script src="assets/js/navbar_offset_scroller.js"></script>
</body>
</html>
